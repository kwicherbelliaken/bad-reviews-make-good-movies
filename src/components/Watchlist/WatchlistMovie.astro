---
import MoviePoster from "./MoviePoster.astro";
import { RemoveWatchlist } from "./RemoveWatchlist";

const { movie } = Astro.props;

const width = 500;
const height = 750;

const response = await fetch(
  `https://dz76rj93fd.execute-api.ap-southeast-2.amazonaws.com/image?fileSize=w${width}&posterPath=${movie.movieDetails.poster_path}`,
  {
    method: "GET",
    headers: {
      "Content-Type": "application/json",
    },
  }
);

const imageUrl = await response.json();
---

<div class="flex bg-grey-50 justify-between rounded-lg border p-4 gap-4">
  <div class="flex justify-center w-[50%]">
    <MoviePoster imageUrl={imageUrl} />
  </div>
  <div class="flex-col w-[50%] relative">
    <RemoveWatchlist client:visible movieId={movie.id}/>

    <h1>{movie.movieDetails.title}</h1>

    <h2 class="font-afterAllBoldSerif font-bold text-2xl tracking-wide">
      {movie.movieDetails.release_date}
    </h2>

    <p class="indent-7">{movie.movieDetails.overview}</p>

    <div class="py-10">
      {
        (movie.movieDetails.cast ?? []).map((cast) => (
          <p class="indent-7">
            {cast.name} as {cast.character}
          </p>
        ))
      }
    </div>

    {
      movie.movieDetails.genres.length > 0 && (
        <div class="border-t-[1px] border-b-[1px] border-black flex flex-row gap-4 justify-center py-6">
          {movie.movieDetails.genres.map((genre: string) => (
            <p class="">{genre}</p>
          ))}
        </div>
      )
    }
  </div>
</div>
